#!/usr/bin/env node

import argv, { _, mnemonic, base58, seed } from "../lib/argv";
import { secretPrompt, mnemonicPrompt, hdPrompt, cli } from "../lib/propmt";


let args = process.argv.splice(2);
if (args.length) {
    if (process.stdin) {
        process.stdin.setEncoding('utf8')
        process.stdin.resume()
        let content = ''
        process.stdin.on('data', (buf) => {
            content += buf.toString()
        })
        setTimeout(() => {
            if (!_.length) {
                // 默认mnemonic
                mnemonic = (content || mnemonic || '').trim()

                if (base58 != undefined) {

                    base58 = (content || base58 || '').trim()
                    mnemonic = ""
                }

                if (seed != undefined) {
                    seed = (content || seed || '').trim()
                    mnemonic = ""
                }
                // console.log(argv)
                cli.generateAddress(argv)
            }
            process.exit(0)

        }, 10)
    }
} else {
    secretPrompt().then((answers) => {
            if (answers.language) {
                mnemonicPrompt(answers.language).then(res => {
                    answers.secret = res.secret
                    hdPrompt(answers)
                })
            } else {
                hdPrompt(answers)
            }
        }
    );
}
